<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hide & Seek - Game</title>
    <link rel="stylesheet" href="style.css">
</head>
<body class="game-page">
    <div class="stars"></div>
    <div class="stars2"></div>
    <div class="stars3"></div>
    
    <header class="game-header">
        <div class="header-left">
            <h1 class="game-title">HIDE & SEEK</h1>
            <div class="wallet-badge" id="walletBadge">
                <span id="walletAddress">Not Connected</span>
            </div>
        </div>
        <div class="header-right">
            <div class="balance-display">
                <span class="balance-label">Balance:</span>
                <span class="balance-value" id="balanceValue">0 ETH</span>
            </div>
            <button class="btn-icon-only" id="refreshBtn" title="Refresh">üîÑ</button>
        </div>
    </header>
    
    <div class="game-container">
        <div class="game-sidebar">
            <div class="sidebar-section">
                <h3>üéÆ Quick Actions</h3>
                <button class="btn-action" id="createGameBtn">
                    <span>‚ûï</span> Create Game
                </button>
                <button class="btn-action" id="joinGameBtn">
                    <span>üîç</span> Join Game
                </button>
                <button class="btn-action" id="myGamesBtn">
                    <span>üìã</span> My Games
                </button>
            </div>
            
            <div class="sidebar-section">
                <h3>üìä Game Stats</h3>
                <div class="stat-item">
                    <span>Active Games:</span>
                    <span id="activeGamesCount">0</span>
                </div>
                <div class="stat-item">
                    <span>Total Staked:</span>
                    <span id="totalStaked">0 ETH</span>
                </div>
                <div class="stat-item">
                    <span>Contract Balance:</span>
                    <span id="contractBalance">Loading...</span>
                </div>
                <div class="stat-item" style="margin-top: 10px; padding-top: 10px; border-top: 1px solid rgba(255,255,255,0.1);">
                    <button class="btn-small" onclick="checkContractBalance()" style="width: 100%; margin-top: 5px;">
                        üîç Check Contract Balance
                    </button>
                </div>
            </div>
        </div>
        
        <div class="game-main">
            <div class="game-tabs">
                <button class="tab-btn active" data-tab="available">Available Games</button>
                <button class="tab-btn" data-tab="active">Active Games</button>
                <button class="tab-btn" data-tab="my-games">My Games</button>
            </div>
            
            <div class="tab-content active" id="availableTab">
                <div class="games-grid" id="availableGames">
                    <div class="loading">Loading games...</div>
                </div>
            </div>
            
            <div class="tab-content" id="activeTab">
                <div class="games-grid" id="activeGames">
                    <div class="loading">Loading active games...</div>
                </div>
            </div>
            
            <div class="tab-content" id="myGamesTab">
                <div class="games-grid" id="myGames">
                    <div class="loading">Loading your games...</div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Game Modal -->
    <div class="modal" id="gameModal">
        <div class="modal-content">
            <span class="close" id="closeModal">&times;</span>
            <div id="modalBody"></div>
        </div>
    </div>
    
    <!-- Create Game Modal -->
    <div class="modal" id="createModal">
        <div class="modal-content">
            <h2>Create New Game</h2>
            <div class="form-group">
                <label>Stake Amount (ETH)</label>
                <select id="stakeAmount">
                    <option value="0.00001">0.00001</option>
                    <option value="0.0001">0.0001</option>
                    <option value="0.001">0.001</option>
                </select>
                <small>Choose stake amount</small>
            </div>
            <button class="btn-primary" id="confirmCreateBtn">Create Game</button>
            <button class="btn-secondary" id="cancelCreateBtn">Cancel</button>
        </div>
    </div>
    
    <!-- Join Game Modal -->
    <div class="modal" id="joinModal">
        <div class="modal-content">
            <h2>Join Game</h2>
            <div class="form-group">
                <label>Game ID</label>
                <input type="number" id="joinGameId" placeholder="Enter Game ID">
            </div>
            <div class="form-group">
                <label>Stake Amount (ETH)</label>
                <select id="joinStakeAmount">
                    <option value="0.00001">0.00001</option>
                    <option value="0.0001">0.0001</option>
                    <option value="0.001">0.001</option>
                </select>
                <small>Match the creator's stake</small>
            </div>
            <div class="form-group">
                <label>Access Code</label>
                <input type="text" id="joinGameCode" placeholder="Enter one-time code">
                <small>Ask the creator for the access code</small>
            </div>
            <button class="btn-primary" id="confirmJoinBtn">Join Game</button>
            <button class="btn-secondary" id="cancelJoinBtn">Cancel</button>
        </div>
    </div>
    
    <!-- Hide Location Modal -->
    <div class="modal" id="hideModal">
        <div class="modal-content">
            <h2>Set Hide Location</h2>
            <div class="form-group">
                <label>Location (Number 1-100)</label>
                <input type="number" id="hideLocation" min="1" max="100" placeholder="1-100">
            </div>
            <div class="form-group">
                <label>Secret Key</label>
                <input type="text" id="hideSecret" placeholder="Any secret phrase">
            </div>
            <button class="btn-primary" id="confirmHideBtn">Set Location</button>
            <button class="btn-secondary" id="cancelHideBtn">Cancel</button>
        </div>
    </div>
    
    <!-- Reveal Location Modal -->
    <div class="modal" id="revealModal">
        <div class="modal-content">
            <h2>Reveal Location</h2>
            <div class="form-group">
                <label>Location (Number 1-100)</label>
                <input type="number" id="revealLocation" min="1" max="100" placeholder="1-100">
            </div>
            <div class="form-group">
                <label>Secret Key</label>
                <input type="text" id="revealSecret" placeholder="Enter your secret">
            </div>
            <button class="btn-primary" id="confirmRevealBtn">Reveal Location</button>
            <button class="btn-secondary" id="cancelRevealBtn">Cancel</button>
        </div>
    </div>
    
    <!-- Seek Location Modal -->
    <div class="modal" id="seekModal">
        <div class="modal-content">
            <h2>Claim Found</h2>
            <div class="form-group">
                <label>Location (Number 1-100)</label>
                <input type="number" id="seekLocation" min="1" max="100" placeholder="1-100">
            </div>
            <button class="btn-primary" id="confirmSeekBtn">Claim Found</button>
            <button class="btn-secondary" id="cancelSeekBtn">Cancel</button>
        </div>
    </div>
    
    <script>
        (function () {
            const ethersSources = [
                'https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js',
                'https://cdnjs.cloudflare.com/ajax/libs/ethers/5.7.2/ethers.umd.min.js',
                'https://cdn.ethers.io/lib/ethers-5.7.2.umd.min.js'
            ];

            function loadScript(src) {
                return new Promise((resolve, reject) => {
                    const script = document.createElement('script');
                    script.src = src;
                    script.async = false;
                    script.onload = () => resolve();
                    script.onerror = () => reject(new Error('Failed to load script: ' + src));
                    document.head.appendChild(script);
                });
            }

            function loadEthers(index) {
                if (index >= ethersSources.length) {
                    return Promise.reject(new Error('Unable to load ethers.js from any source'));
                }

                const src = ethersSources[index];
                return loadScript(src)
                    .then(() => {
                        if (typeof window.ethers !== 'undefined') {
                            return;
                        }
                        console.warn(`Loaded ${src} but window.ethers is undefined. Trying next source.`);
                        return loadEthers(index + 1);
                    })
                    .catch((error) => {
                        console.warn(error.message);
                        return loadEthers(index + 1);
                    });
            }

            loadEthers(0)
                .then(() => loadScript('script.js'))
                .then(() => loadScript('game.js'))
                .catch((error) => {
                    console.error('Failed to initialize game scripts:', error);
                    const warning = document.createElement('div');
                    warning.style.cssText = 'position:fixed; top:20px; left:50%; transform:translateX(-50%); padding:16px 24px; background:rgba(255,51,102,0.9); color:#fff; border-radius:10px; z-index:5000; font-weight:600;';
                    warning.textContent = 'Failed to load game scripts. Please check your internet connection.';
                    document.body.appendChild(warning);
                });
        })();
    </script>
</body>
</html>

